!function(){var t=!1,i=/xyz/.test(function(){})?/\b_super\b/:/.*/;this.GumroadClass=function(){},GumroadClass.extend=function(e){function n(){!t&&this.init&&this.init.apply(this,arguments)}var a=this.prototype;t=!0;var r=new this;t=!1;for(var s in e)r[s]="function"==typeof e[s]&&"function"==typeof a[s]&&i.test(e[s])?function(t,i){return function(){var e=this._super;this._super=a[t];var n=i.apply(this,arguments);return this._super=e,n}}(s,e[s]):e[s];return n.prototype=r,n.prototype.constructor=n,n.extend=arguments.callee,n}}(),function(){"use strict";function t(){window.gumroadOverlay||(window.gumroadOverlay=new e)}var i=GumroadClass.extend({init:function(t,i){this.element=t,this.manager=i,this.vars={as_modal:!0,source_url:encodeURIComponent(window.location.href),referrer:encodeURIComponent(document.referrer+"/"+window.location.search.substring(1))},this.validateUrl()},validUrlParams:"locale source_url referrer wanted email gift monthly quarterly biannually yearly".split(/\s+/),makeActiveLink:function(){var t=document.createElement("span"),i=this;this.manager.hasClass(this.element,"gumroad-button")&&(t.className="gumroad-button-logo",this.element.insertBefore(t,this.element.firstChild)),this.manager.isMobile||(this.element.getAttribute("data-gumroad-single-product")&&(this.manager.isSingleOverlay=!0),window.location.origin!=this.manager.domain&&(this.element.target="_blank"),this.element.onclick=function(t){t.preventDefault(),i.manager.showInIframe(i)})},setUrlVars:function(t){if(t){var i=t.split("&");if(i.length)for(var e=0;e<i.length;e++)if(i[e]){var n=i[e].split("=");2===n.length&&this.validUrlParams.indexOf(n[0])>-1&&(this.vars[n[0]]=n[1])}}},validateUrl:function(){for(var t=this.element.href.split("?"),i=t[0],e=0;e<this.manager.productMatches.length;e++){var n=this.manager.productMatches[e];if(0===i.indexOf(n)){var a=i.replace(n,"").split("/");return this.vars.permalink=a[0],a[1]&&a[1].length>0&&(this.vars.offerCodeName=a[1]),this.setUrlVars(t[1]),this.manager.links.push(this),this.manager.allPermalinks.push(this.vars.permalink),this.makeActiveLink(),!0}}delete this}}),e=GumroadClass.extend({init:function(t){this.links=[],this.allPermalinks=[],this.setEnvironment(),window.addEventListener?window.addEventListener("message",function(t){this.gotMessage(t)}.bind(this),!1):window.attachEvent("onmessage",function(t){this.gotMessage(t)}.bind(this),!1),this.insertStylesheet(),this.insertLoadingIndicator(),this.bindKeys(),this.addLinks(),1==this.links.length&&(this.isSingleOverlay=!0)},addClass:function(t,i){var e=t.classList.toString().split(/\s+/);this.hasClass(t,i)&&(e.push(i),t.className=className.join(" "))},addLinks:function(){for(var t=document.getElementsByTagName("a"),e=this,n=0;n<t.length;n++)new i(t[n],e)},append:function(t,i){i=i?i:"body",document.getElementsByTagName(i)[0].appendChild(t)},askForProduct:function(){this.messageIframe({overlayMethod:"getProduct",overlayArgs:this.currentLink.vars})},bindKeys:function(){document.onkeydown=function(t){27===t.keyCode&&this.minimizeIframe()}.bind(this)},buildIframeSrc:function(){var t=this.domain+"/",i=[];this.isSingleOverlay?(t+="l/"+this.currentLink.vars.permalink,this.currentLink.vars.offerCodeName&&(t+="/"+this.currentLink.vars.offerCodeName)):(t+="overlay_page",i.push("all_permalinks="+this.allPermalinks.join(",")));for(var e in this.currentLink.vars)this.currentLink.vars.hasOwnProperty(e)&&i.push(e+"="+this.currentLink.vars[e]);return i.length>0&&(t+="?"+i.join("&")),t},createIframe:function(){var t=this;this.iframe&&(this.iframe.remove(),delete this.iframe,delete this.iframeReady),this.iframe=document.createElement("iframe"),this.iframe.allowtransparency=!0,this.iframe.className="gumroad-overlay-iframe",this.iframe.onload=function(){t.setupMessaging()},this.iframe.src=this.buildIframeSrc(),this.append(this.iframe)},gotMessage:function(t){var i={};if(t.data)try{i=JSON.parse(t.data)}catch(e){}i.parentMethod&&this[i.parentMethod]&&this[i.parentMethod](i.parentArgs)},handshake:function(){this.iframeReady||(this.iframeReady=!0,clearInterval(this.handshakeTimer),delete this.handshakeTimer,this.messagingSetupCallback())},hasClass:function(t,i){return t.classList.toString().split(/\s+/).indexOf(i)>-1},hideLoadingIndicator:function(){this.setOpacity(this.loadingIndicator,0)},insertLoadingIndicator:function(){this.loadingIndicator=document.createElement("div"),this.loadingIndicator.className="gumroad-loading-indicator",this.loadingIndicator.appendChild(document.createElement("i")),this.append(this.loadingIndicator)},insertStylesheet:function(){var t='a.gumroad-button { background-color: white !important; background-image: url("GUMROAD_ORIGIN/button/button_bar.jpg") !important; background-repeat: repeat-x !important; border-radius: 4px !important; box-shadow: rgba(0, 0, 0, .4) 0 0 2px !important; color: #999 !important; display: inline-block !important; font-family: "Helvetica Neue", Helvetica, Arial, sans-serif !important; font-size: 16px !important; font-style: normal !important; font-weight: 500 !important; line-height: 50px !important; padding: 0 15px !important; text-shadow: none !important; text-decoration: none !important; } .gumroad-button-logo { background-image: url("GUMROAD_ORIGIN/button/button_logo.png") !important; background-size: cover !important; height: 17px !important; width: 16px !important; display: inline-block !important; margin-bottom: -3px !important; margin-right: 15px !important; } .gumroad-loading-indicator { position: fixed; z-index: 2000; top: 50% !important; left: 50% !important; margin-left: -20px !important; margin-top: -20px !important; background: transparent; display: none; } .gumroad-loading-indicator i { background: url("GUMROAD_ORIGIN/js/loading-rainbow.svg"); height: 40px; width: 40px; display: inline-block; background-size: contain; -webkit-animation: gumroad-spin 1.5s infinite linear; animation: gumroad-spin 1.5s infinite linear; } .gumroad-overlay-iframe { position: fixed !important; overflow: scroll !important; z-index: 9999 !important; top: 0 !important; right: 0 !important; width: 0; height: 0; border: none !important; margin: 0 !important; padding: 0 !important; zoom: 1; } @-webkit-keyframes gumroad-spin { 0% { -webkit-transform: rotate(0deg); transform: rotate(0deg); } 100% { -webkit-transform: rotate(359deg); transform: rotate(359deg); } } @keyframes gumroad-spin { 0% { -webkit-transform: rotate(0deg); transform: rotate(0deg); } 100% { -webkit-transform: rotate(359deg); transform: rotate(359deg); } } '.replace(/GUMROAD_ORIGIN/g,this.domain),i=document.createElement("style");i.type="text/css",i.appendChild(document.createTextNode(t)),this.append(i,"head")},maximizeIframe:function(){this.hideLoadingIndicator(),this.resizeIframe({height:"100%",width:"100%"}),this.messageIframe({overlayMethod:"maximizeCallback"})},messageIframe:function(t){"object"==typeof t&&(t=JSON.stringify(t)),this.iframe.contentWindow.postMessage(t,this.domain)},messagingSetupCallback:function(){this.isSingleOverlay?this.showSingleProduct():this.askForProduct()},minimizeIframe:function(t){this.hideLoadingIndicator(),this.resizeIframe(t),this.messageIframe({overlayMethod:"minimizeCallback"})},removeClass:function(t,i){for(;this.hasClass(t,i);){var e=t.classList.toString().split(/\s+/),n=e.indexOf(i);n>-1&&e.splice(n,1),t.className=e.join(" ")}},resizeIframe:function(t){t=t?t:{width:"0px",height:"0px"},t.width&&(this.iframe.style.width=t.width),t.height&&(this.iframe.style.height=t.height)},sendDomain:function(){this.messageIframe({overlayMethod:"setOverlayParentDomain",overlayArgs:window.location.origin})},setEnvironment:function(){this.environment="production",this.domain={development:"http://localhost:3333",production:"https://gumroad.com",staging:"https://staging.gumroad.com",staging_x:"https://staging-x.gumroad.com"}[this.environment],this.productMatches={development:["http://l.h:3333/l/","http://local.host:3333/l/","http://localhost:3333/l/"],production:["http://gum.co/","https://gum.co/","https://gumroad.com/l/"],staging:["http://staging.gum.co/","https://staging.gum.co/","https://staging.gumroad.com/l/"],staging_x:["https://staging-x.gumroad.com/l/"]}[this.environment],this.isMobile=navigator.userAgent.match(/Mobile[\/; ]/i)||navigator.userAgent.match(/Opera (Mini|Mobi)/i)||navigator.userAgent.match(/IEMobile/i)},setOpacity:function(t,i){t.style.display=0===i?"none":"block",t.style.opacity=t.style.MozOpacity=t.style.khtmlOpacity=i,t.style.filter="alpha(opacity="+100*i+");"},setupMessaging:function(){this.handshakeTimer=setInterval(function(){this.sendDomain()}.bind(this),100)},showInIframe:function(t){this.currentLink=t,this.showLoadingIndicator(),this.iframeReady&&!this.isSingleOverlay?this.askForProduct():this.createIframe()},showLoadingIndicator:function(){this.setOpacity(this.loadingIndicator,.6)},showSingleProduct:function(){this.maximizeIframe(),this.messageIframe({overlayMethod:"setIsSingleLink"}),this.messageIframe({overlayMethod:"refreshPreview"})}});window.addEventListener?window.addEventListener("load",t):window.attachEvent&&window.attachEvent("onload",t)}();